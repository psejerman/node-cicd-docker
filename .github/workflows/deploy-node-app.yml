name: sample
env:
  sudo_pass: ${{ secrets.SUDOPASS }}
  
on:
  workflow_dispatch:
  #push:
  #  branches:
  #    - main

  # DEBUG: echo "$db_user":"$db_pass" > /opt/projects/cred


jobs:
  deploy:
    runs-on: self-hosted
    steps:
    - name: Checkout the repository
      uses: actions/checkout@v2

    - name: Compose app with docker
      env:
        db_pass: ${{ secrets.DB_PASSWD }}
        db_user: ${{ secrets.DB_USERNAME }}
      run: |
        echo MONGO_INITDB_ROOT_USERNAME=db_user >> .env
        echo MONGO_INITDB_ROOT_PASSWORD=db_pass >> .env
        echo MONGO_INITDB_DATABASE=test >> .env
        echo "$sudo_pass" | sudo -S docker compose -f /opt/projects/node-cicd-docker/node-cicd-docker/app-compose.yml up --detach

        
       
